ниже — готовый фрагмент для README. Копируй целиком, он аккуратно оформлен и сразу включает ASCII-контекст (C4-1), легенду потоков и ссылки на файлы.

---

# Архитектура (C4 + UML)

**Версия:** v0.1 • **Дата:** 30/10/2025 • **Автор:** Nastya Khvostovets

Описываем архитектуру сервиса по нотации C4 (и немного UML для последовательностей/деплоймента).
Правила: рисуем в draw.io, в PR прикладываем **и** исходник (`.drawio`), **и** экспорт (`.svg`).

## Диаграммы (пути в репо)

1. Контекст — `docs/architecture/exports/01-context.svg`
2. Контейнеры — `docs/architecture/exports/02-container.svg`
3. Компоненты (Inference API) — `docs/architecture/exports/03-component-inference.svg`
4. Поток данных (обучение) — `docs/architecture/exports/04-dataflow-training.svg`
5. Последовательность (Inference request) — `docs/architecture/exports/05-sequence-inference.svg`
6. Деплоймент — `docs/architecture/exports/06-deployment.svg`

> В каждом PR к диаграммам обязательно: `sources/*.drawio` + `exports/*.svg`.

## Легенда потоков (F# → тип)

* **[API]** — онлайн-вызовы между браузером и сервисом (сплошные линии на схеме).
* **[UI]** — действия пользователя в интерфейсе (пунктир).
* **[OFFLINE]** — офлайн-поставка артефактов из обучения (красный пунктир).
* **[LOG]** — служебные внутренние записи (тонкая/оранжевая).

### Расшифровка F1…F8

| Код | Тип      | Откуда → Куда            | Коротко                                                          |
| --- | -------- | ------------------------ | ---------------------------------------------------------------- |
| F1  | UI       | Пользователь → Браузер   | Пользователь работает через Web UI                               |
| F2  | API      | Браузер → Рантайм        | `POST /v1/predict` (multipart/form-data, JPG/PNG ≤ N MB)         |
| F3  | API      | Рантайм → Браузер        | `200 JSON {label, probs, latency_ms, model}`                     |
| F4  | UI       | Браузер → Пользователь   | Визуализация результата в UI                                     |
| F5  | LOG      | Рантайм → Артефакты/логи | `request_id, время, размер, top-K` (без исходных изображений)    |
| F6a | OFFLINE  | ISIC Dataset → Training  | Обучающие данные (офлайн)                                        |
| F6b | OFFLINE  | Training → Рантайм       | Экспорт модели: `.onnx/.pt`, `preprocessing.json`, `labels.json` |
| F7  | OFFLINE  | GitHub → Рантайм         | Код и конфигурации (CI/CD/сборка)                                |
| F8  | OFFLINE* | Рантайм → GitHub         | Ручная публикация отчётов/метрик (*manual*)                      |

---

## Часть 1. Контекст (ASCII, C4-1)

```
+------------------------------------------------------------------------------------------------------+
|                                   Контекст: ISIC Skin Classifier (C4-1)                              |
+------------------------------------------------------------------------------------------------------+

[Пользователь]
Врач / Исследователь
      . . . . . . . . . . . . . . . . . . . . .   F1 [UI]   . . . . . . . . . . . . . . . . . . . . .
      v                                                                                               .
[Браузер (Web UI)] -----------------------------------------------------------------------------------+ 
      |                                   F2 [API]  POST /v1/predict (multipart/form-data)            |
      v                                                                                               |
/-------------------------------------- ГРАНИЦА СИСТЕМЫ (рантайм) -------------------------------------|---\
| [ISIC Skin Classifier]                                                                               |   |
|   Interfaces: Streamlit (UI), FastAPI (REST) • Runtime: PyTorch / ONNX • Форматы: JPG/PNG            |   |
|                                                                                                      |   |
|                 ^                                                                                    |   |
|                 |               F3 [API] 200 JSON {label, probs, latency_ms, model}                  |   |
|                 |                                                                                    |   |
|                 +----------------------------------------------- ответ ------------------------------+   |
|                                                                                                          |
|           F5 [LOG]                                                                                       |
|                └──→ [Артефакты и логи]  (reports/*, metrics, audit; без исходных изображений)            |
\----------------------------------------------------------------------------------------------------------/

                                            . . . . . . . . . . . . . . . . . . . . . . . .
                                          .             СРЕДА ОБУЧЕНИЯ (офлайн)            .
                                          .                                                .
                                          .  [ISIC Dataset] -- F6a [OFFLINE] --> [Training Pipeline]  .
                                          .                                 |                          .
                                          .                                 |  F6b [OFFLINE]           .
                                          .                                 v                          .
                                          .       (model.onnx/.pt, preprocessing.json, labels.json)    .
                                          .       -----------------------------------------------> (в Рантайм)
                                          .                                                .
                                          .  [GitHub] ---------------------- F7 [OFFLINE] ----------> (в Рантайм)
                                          .                                                .
                                          .  <---------------------- F8 [OFFLINE/manual] ------------  .
                                          .            публикация отчётов/метрик вручную              .
                                          . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

F4 [UI] визуализация результата  <-------------------------  [Браузер (Web UI)]
```

---

## Мини-спека API (для консистентности)

* **POST `/v1/predict`**
  Вход: `multipart/form-data`, поле `file` (JPG/PNG, ≤ N MB)
  Выход `200`:

  ```json
  {
    "label": "melanoma",
    "probs": {"melanoma": 0.81, "nevus": 0.14, "keratosis": 0.05},
    "topk": [{"label":"melanoma","p":0.81}],
    "model": "efficientnet_b0_isic2018_v1",
    "latency_ms": 112
  }
  ```

  Ошибки: `400` (format/size), `415` (content-type), `500` (internal)

---

## Стили для draw.io (кратко)

* **Шрифт:** Segoe UI
* **Цвета (RGB):**
  шапка (15,23,42); роль (253,230,138) или розовый (236,72,153); сервис (16,185,129); данные (245,158,11); внешняя (100,116,139);
  граница доверия/оффлайн (244,63,94); линии API (51,65,85); UI-пунктир (100,116,139); логи (245,158,11); фон (248,250,252).
* **Типы линий:**
  API — сплошная; UI — пунктир `6 6`; OFFLINE — пунктир `8 6` (красный); LOG — тонкая сплошная (оранжевая).
* На диаграммах у стрелок ставим **только коды F#**, расшифровка — в таблице выше.


